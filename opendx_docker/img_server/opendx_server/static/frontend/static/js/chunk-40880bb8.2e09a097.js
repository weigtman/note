(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-40880bb8"],{1290:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-form",{attrs:{data:t.globalVar,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"所属分类"}},[n("el-select",{attrs:{clearable:"",filterable:"",placeholder:"选择分类"},on:{"visible-change":t.categorySelectChange},model:{value:t.globalVar.categoryId,callback:function(e){t.$set(t.globalVar,"categoryId",e)},expression:"globalVar.categoryId"}},t._l(t.categories,function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),n("el-button",{on:{click:function(e){return t.$router.push({name:"AddGlobalVarCategory"})}}},[t._v("+")])],1),t._v(" "),n("el-form-item",{attrs:{label:"变量类型",rules:[{required:!0}]}},[n("el-input",{staticStyle:{width:"300px"},attrs:{clearable:""},model:{value:t.globalVar.type,callback:function(e){t.$set(t.globalVar,"type","string"===typeof e?e.trim():e)},expression:"globalVar.type"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"变量名",rules:[{required:!0}]}},[n("el-input",{staticStyle:{width:"300px"},attrs:{clearable:""},model:{value:t.globalVar.name,callback:function(e){t.$set(t.globalVar,"name","string"===typeof e?e.trim():e)},expression:"globalVar.name"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"变量值",rules:[{required:!0}]}},[n("el-table",{attrs:{data:t.globalVar.environmentValues,border:""}},[n("el-table-column",{attrs:{align:"center",label:"环境",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择环境"},on:{"visible-change":t.envSelectChange},model:{value:a.environmentId,callback:function(e){t.$set(a,"environmentId",e)},expression:"row.environmentId"}},t._l(t.environmentList,function(t){return n("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})}),1)]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",label:"值"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("image-input",{model:{value:a.value,callback:function(e){t.$set(a,"value","string"===typeof e?e.trim():e)},expression:"row.value"}})]}}])}),t._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button-group",[n("el-button",{on:{click:function(n){return t.addEnvironmentValue(e.$index)}}},[t._v("+")]),t._v(" "),n("el-button",{attrs:{disabled:0===e.$index},on:{click:function(n){return t.delEnvironmentValue(e.$index)}}},[t._v("-")])],1)]}}])})],1)],1),t._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{staticStyle:{width:"300px"},attrs:{type:"textarea"},model:{value:t.globalVar.description,callback:function(e){t.$set(t.globalVar,"description","string"===typeof e?e.trim():e)},expression:"globalVar.description"}})],1),t._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:t.saveGlobalVar}},[t._v("保 存")])],1)],1)},r=[],i=n("1f53"),l=n("c405"),o=n("6d17"),s=n("ab2e"),c={props:{isAdd:Boolean},components:{ImageInput:s["a"]},data:function(){return{globalVar:{id:void 0,type:"String",name:"",environmentValues:[{environmentId:-1,value:""}],description:"",categoryId:void 0,projectId:this.$store.state.project.id},environmentList:[{id:-1,name:"默认"}],categories:[]}},created:function(){var t=this;this.fetchEnvironmentList(),this.fetchCategoryList(),this.isAdd||Object(i["c"])({id:this.$route.params.globalVarId}).then(function(e){t.globalVar=e.data[0]})},methods:{fetchCategoryList:function(){var t=this;Object(l["c"])({projectId:this.globalVar.projectId,type:3}).then(function(e){t.categories=e.data})},categorySelectChange:function(t){t&&this.fetchCategoryList()},envSelectChange:function(t){t&&this.fetchEnvironmentList()},saveGlobalVarSuccess:function(t){var e=this;this.$notify.success(t),this.$store.dispatch("tagsView/delView",this.$store.state.tagsView.visitedViews.filter(function(t){return t.path===e.$route.path})[0]),this.$router.back()},saveGlobalVar:function(){var t=this;this.isAdd?Object(i["a"])(this.globalVar).then(function(e){t.saveGlobalVarSuccess(e.msg)}):Object(i["d"])(this.globalVar).then(function(e){t.saveGlobalVarSuccess(e.msg)})},fetchEnvironmentList:function(){var t=this;Object(o["c"])({projectId:this.$store.state.project.id}).then(function(e){t.environmentList=[{id:-1,name:"默认"}].concat(e.data)})},addEnvironmentValue:function(t){this.globalVar.environmentValues.splice(t+1,0,{environmentId:void 0,value:""})},delEnvironmentValue:function(t){this.globalVar.environmentValues.splice(t,1)}}},u=c,d=n("2877"),f=Object(d["a"])(u,a,r,!1,null,null,null);e["a"]=f.exports},"1f53":function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"d",function(){return i}),n.d(e,"c",function(){return l}),n.d(e,"b",function(){return o});var a=n("b775");function r(t){return Object(a["a"])({method:"post",url:"/globalVar/add",data:t})}function i(t){return Object(a["a"])({method:"post",url:"/globalVar/update",data:t})}function l(t){return Object(a["a"])({method:"post",url:"/globalVar/list",params:t})}function o(t){return Object(a["a"])({method:"delete",url:"/globalVar/"+t})}},"32b7":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("save-global-var",{attrs:{"is-add":!1}})],1)},r=[],i=n("1290"),l={name:"UpdateGlobalVar",components:{SaveGlobalVar:i["a"]}},o=l,s=n("2877"),c=Object(s["a"])(o,a,r,!1,null,"684bbe40",null);e["default"]=c.exports},"6d17":function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return i}),n.d(e,"d",function(){return l}),n.d(e,"c",function(){return o});var a=n("b775");function r(t){return Object(a["a"])({method:"post",url:"/environment/add",data:t})}function i(t){return Object(a["a"])({method:"delete",url:"/environment/"+t})}function l(t){return Object(a["a"])({method:"post",url:"/environment/update",data:t})}function o(t){return Object(a["a"])({method:"post",url:"/environment/list",params:t})}},ab2e:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[t.isBase64Png?n("el-image",{staticStyle:{width:"100px"},attrs:{src:t.src,"preview-src-list":[t.src]}}):t._e(),t._v(" "),t.isBase64Png?n("el-input",{staticStyle:{width:"100px"},attrs:{clearable:""},nativeOn:{paste:function(e){return t.onpaste(e)}},model:{value:t.currentValue,callback:function(e){t.currentValue="string"===typeof e?e.trim():e},expression:"currentValue"}}):t._e(),t._v(" "),t.isBase64Png?t._e():n("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:10}},nativeOn:{paste:function(e){return t.onpaste(e)}},model:{value:t.currentValue,callback:function(e){t.currentValue="string"===typeof e?e.trim():e},expression:"currentValue"}})],1)},r=[],i=(n("4917"),n("f559"),n("c5f6"),{name:"ImageInput",props:{value:[String,Number]},data:function(){return{base64PngSrcPrefix:"data:image/png;base64,",base64PngPrefix:"iVBORw0KGgoAAAANSUhEUgAA",currentValue:this.value}},computed:{isBase64Png:function(){return!!this.currentValue&&this.currentValue.startsWith(this.base64PngPrefix)},src:function(){return this.base64PngSrcPrefix+this.currentValue}},watch:{value:function(t){this.currentValue=t},currentValue:function(t){this.$emit("input",t)}},methods:{onpaste:function(t){var e=this;if(t.clipboardData&&t.clipboardData.items){var n=t.clipboardData.items[0];if(n&&"file"===n.kind&&n.type.match(/^image\//i)){console.log("paste img to base64");var a=n.getAsFile(),r=new FileReader;r.onload=function(t){e.currentValue=t.target.result.substring(22)},r.readAsDataURL(a)}}}}}),l=i,o=n("2877"),s=Object(o["a"])(l,a,r,!1,null,null,null);e["a"]=s.exports},c405:function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"a",function(){return i}),n.d(e,"b",function(){return l});var a=n("b775");function r(t){return Object(a["a"])({method:"post",url:"/category/list",params:t})}function i(t){return Object(a["a"])({method:"post",url:"/category/add",data:t})}function l(t){return Object(a["a"])({method:"delete",url:"/category/"+t})}},f559:function(t,e,n){"use strict";var a=n("5ca1"),r=n("9def"),i=n("d2c8"),l="startsWith",o=""[l];a(a.P+a.F*n("5147")(l),"String",{startsWith:function(t){var e=i(this,t,l),n=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),a=String(t);return o?o.call(e,a,n):e.slice(n,n+a.length)===a}})}}]);